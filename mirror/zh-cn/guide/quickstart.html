<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tbox</title>
  <link rel="icon" href="/assets/img/favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link href="//cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" rel="stylesheet">
  <style>
	.markdown-body {
		box-sizing: border-box;
		min-width: 200px;
		max-width: 980px;
		margin: 0 auto;
		padding: 45px;
	}

	@media (max-width: 767px) {
		.markdown-body {
			padding: 15px;
		}
	}
  </style>
</head>
<body>
<article class="markdown-body">
<h2>Note: this is the mirror page, if you want to see the original page, please goto: </h2>
<a href="https://tboox.io/#/zh-cn/guide/quickstart">https://tboox.io/#/zh-cn/guide/quickstart</a>
</br>
    <h2 id="-">å‡†å¤‡å·¥ä½œ</h2>
<h3 id="-xmake">å®‰è£…xmake</h3>
<p>ç¼–è¯‘tboxæºç ï¼Œéœ€è¦å…ˆå®‰è£…<a href="https://github.com/xmake-io/xmake">xmake</a>æ„å»ºå·¥å…·ï¼Œå› ä¸ºæ•´ä¸ªtboxé¡¹ç›®éƒ½æ˜¯ç”±xmakeè¿™ä¸ªè·¨å¹³å°çš„æ„å»ºå·¥å…·ç»´æŠ¤çš„ã€‚</p>
<p>å…³äºå¦‚ä½•å®‰è£…xmakeï¼Œå¯ä»¥çœ‹ä¸‹ï¼š<a href="https://xmake.io/#/zh-cn/guide/installation">xmakeå®‰è£…æ–‡æ¡£</a></p>
<p>é‡Œé¢è®²çš„éå¸¸è¯¦ç»†ï¼Œå½“ç„¶é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸‹é¢çš„å®‰è£…æ–¹å¼åŸºæœ¬ä¸Šå·²ç»å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†å®‰è£…åœºæ™¯ï¼Œé™¤éä½ æƒ³æºç ç¼–è¯‘å®‰è£…ã€‚</p>
<h4 id="-curl">ä½¿ç”¨curl</h4>
<pre><code class="lang-bash">bash &lt;(curl -fsSL https://raw.githubusercontent.com/xmake-io/xmake/master/scripts/get.sh)
</code></pre>
<h4 id="-wget">ä½¿ç”¨wget</h4>
<pre><code class="lang-bash">bash &lt;(wget https://raw.githubusercontent.com/xmake-io/xmake/master/scripts/get.sh -O -)
</code></pre>
<h4 id="-powershell">ä½¿ç”¨powershell</h4>
<pre><code class="lang-bash">Invoke-Expression (Invoke-Webrequest &#39;https://raw.githubusercontent.com/xmake-io/xmake/master/scripts/get.ps1&#39; -UseBasicParsing).Content
</code></pre>
<h2 id="-">åˆ›å»ºç©ºå·¥ç¨‹</h2>
<p>xmakeé‡Œé¢æä¾›äº†å¸¦æœ‰tboxçš„ç©ºå·¥ç¨‹æ¨¡æ¿ï¼Œå› æ­¤å¯ä»¥é€šè¿‡xmakeåˆ›å»ºä¸€ä¸ªåŸºäºtboxçš„ç©ºå·¥ç¨‹ï¼Œæ¥å¿«é€Ÿé›†æˆå’Œç¼–è¯‘ä½¿ç”¨tboxåº“ã€‚</p>
<p>æˆ‘ä»¬åªéœ€è¦æ‰§è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="lang-bash">$ xmake create -t console_tbox test
</code></pre>
<p>æˆ‘ä»¬çš„åŸºäºtboxçš„æ§åˆ¶å°ç¨‹åºå°±åˆ›å»ºå¥½äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªå·¥ç¨‹é‡Œé¢çš„ç»“æ„ï¼š</p>
<pre><code>.
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ main.c
â”‚   â””â”€â”€ xmake.lua
â””â”€â”€ xmake.lua
</code></pre><p>éå¸¸ç®€å•ï¼Œxmake.luaçš„å¤§è‡´å†…å®¹ï¼Œç²¾ç®€ä¸‹ï¼Œå°±é•¿è¿™æ ·ï¼š</p>
<pre><code class="lang-lua">add_requires(&quot;tbox&quot;)
target(&quot;test&quot;)
    set_kind(&quot;binary&quot;)
    add_files(&quot;src/*.c&quot;)
</code></pre>
<p>è¯´ç™½äº†ï¼Œå°±æ˜¯åŠ ä¸Šäº†tboxçš„ä¾èµ–åº“å¼•ç”¨ã€‚</p>
<p>è€Œmain.cé‡Œé¢ï¼Œä»…ä»…åªå¼•ç”¨äº†tbox.hå¤´æ–‡ä»¶ï¼Œéå¸¸ç®€å•ï¼š</p>
<pre><code class="lang-c">#include &quot;tbox/tbox.h&quot;

tb_int_t main(tb_int_t argc, tb_char_t** argv)
{
    // init tbox
    if (!tb_init(tb_null, tb_null)) return -1;

    // trace
    tb_trace_i(&quot;hello tbox!&quot;);

    // exit tbox
    tb_exit();
    return 0;
}
</code></pre>
<h2 id="-">ç¼–è¯‘å·¥ç¨‹</h2>
<p>åˆ›å»ºå®Œå·¥ç¨‹ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¼–è¯‘äº†ï¼Œè¿™æ­¥ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦æ‰§è¡Œxmakeå‘½ä»¤å³å¯å®Œæˆç¼–è¯‘ï¼š</p>
<pre><code class="lang-bash">$ xmake
checking for the architecture ... x86_64
checking for the Xcode directory ... /Applications/Xcode.app
checking for the SDK version of Xcode ... 10.14
checking for the Cuda SDK directory ... /Developer/NVIDIA/CUDA-10.1
note: try installing these packages (pass -y to skip confirm)?
in xmake-repo:
  -&gt; tbox v1.6.3 
please input: y (y/n)

  =&gt; install tbox v1.6.3 .. ok                                                                                                                                                    
ruki:test ruki$ xmake -r 
[  0%]: ccache compiling.release src/main.c
[100%]: linking.release test
build ok!ğŸ‘Œ
</code></pre>
<p>xmakeä¼šå»è‡ªåŠ¨ä¸‹è½½tboxåº“ä¾èµ–ï¼Œå¹¶ä¸”è‡ªåŠ¨å®‰è£…é›†æˆtboxåº“åˆ°å½“å‰é¡¹ç›®ä¸­å»ï¼Œç”¨æˆ·ä¸éœ€è¦å…³å¿ƒå…¶ä»–ä»»ä½•ç»†èŠ‚ï¼Œåªç®¡å®‰å¿ƒæ•²ä»£ç è°ƒç”¨tboxæ¥å£å®ç°è‡ªå·±çš„é€»è¾‘å°±è¡Œäº†ã€‚</p>
<h2 id="-">è¿è¡Œç¨‹åº</h2>
<p>ç¼–è¯‘å®Œï¼Œå¯ä»¥æ•²ä¸‹é¢çš„å‘½ä»¤å®Œæˆè¿è¡Œï¼š</p>
<pre><code class="lang-bash">$ xmake run
</code></pre>
<h2 id="-">è°ƒè¯•ç¨‹åº</h2>
<p>å¦‚æœè¦è°ƒç”¨gdb/lldb/vsjitdebuggerç­‰è°ƒè¯•å™¨æ¥è°ƒè¯•ç¨‹åºï¼Œåªéœ€è¦è¿è¡Œçš„æ—¶å€™åŠ ä¸Š<code>-d</code>å‚æ•°ï¼Œå¹¶ä¸”å¼€å¯è°ƒè¯•ç¼–è¯‘æ¨¡å¼ï¼š</p>
<pre><code class="lang-bash">$ xmake f -m debug
$ xmake
$ xmake run -d
</code></pre>
<p>ç”±äºé»˜è®¤ç¼–è¯‘å¼releaseæ¨¡å¼ï¼Œä¸å¸¦è°ƒè¯•ç¬¦å·ä¿¡æ¯ï¼Œå› æ­¤å¦‚æœè¦è°ƒè¯•ç¨‹åºï¼Œå¯ä»¥å…ˆå¯ç”¨debugæ¨¡å¼ç¼–è¯‘åï¼Œå†è°ƒè¯•è¿è¡Œå³å¯ã€‚</p>
<h2 id="-ide-">ç”ŸæˆIDEå·¥ç¨‹æ–‡ä»¶</h2>
<h3 id="-vs-">ç”Ÿæˆvså·¥ç¨‹</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç”Ÿæˆvså·¥ç¨‹æ¥æ›´æ–¹ä¾¿çš„å¼€å‘å’Œè°ƒè¯•ï¼Œä¸‹é¢çš„å‘½ä»¤åŒæ—¶ç”Ÿæˆå¸¦æœ‰debug, releaseä¸¤ä¸ªç¼–è¯‘æ¨¡å¼çš„vcå·¥ç¨‹ã€‚</p>
<pre><code class="lang-bash">xmake project -k vs2017 -m &quot;debug,release&quot;
</code></pre>
<h3 id="-cmake-">ç”Ÿæˆcmakeæ–‡ä»¶</h3>
<pre><code class="lang-bash">xmake project -k cmakelists
</code></pre>
<h3 id="-makefile">ç”Ÿæˆmakefile</h3>
<pre><code class="lang-bash">xmake project -k makefile
</code></pre>
<h2 id="-">æºç ç¼–è¯‘</h2>
<p>é™¤äº†é€šè¿‡åˆ›å»ºç©ºå·¥ç¨‹ï¼Œåœ¨xmake.luaä¸­ä½¿ç”¨<code>add_requires(&quot;tbox&quot;)</code>å¿«é€Ÿé›†æˆtboxï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç°åœ¨tboxæºç æ‰‹åŠ¨ç¼–è¯‘é›†æˆã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½tboxçš„æºç ï¼š</p>
<pre><code class="lang-bash">git clone https://github.com/tboox/tbox.git
</code></pre>
<p>ç„¶åè¿›å…¥å·¥ç¨‹æ ¹ç›®å½•ï¼Œæ‰§è¡Œxmakeç¼–è¯‘ï¼š</p>
<pre><code class="lang-bash">cd tbox
xmake
</code></pre>
<p>ç¼–è¯‘å®Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£…æˆ–è€…æ‰“åŒ…çš„æ–¹å¼ï¼Œè·å–å¯¹åº”çš„åº“æ–‡ä»¶å’Œå¤´æ–‡ä»¶</p>
<h3 id="-">å®‰è£…åº“</h3>
<p>é€šè¿‡å®‰è£…ï¼Œå¯ä»¥å°†ç¼–è¯‘å¥½çš„åº“å’Œå¤´æ–‡ä»¶å®‰è£…åˆ°ç³»ç»Ÿç›®å½•æˆ–è€…æŒ‡å®šç›®å½•</p>
<pre><code class="lang-bash">xmake install 
xmake install -o /xxx/installdir
</code></pre>
<h3 id="-">æ‰“åŒ…åº“</h3>
<p>ä¸Šé¢å®‰è£…çš„æ–¹å¼ï¼Œåªèƒ½å®‰è£…ä¸€ä¸ªå¹³å°ä¸‹å¯¹åº”archçš„åº“ï¼Œå¦‚æœè¦åŒæ—¶åˆ‡æ¢å¹³å°å’Œæ¶æ„ï¼Œç¼–è¯‘ç”Ÿæˆä¸€ç³»åˆ—åº“ç‰ˆæœ¬ï¼Œè¿™ç§æ–¹å¼å°±å¾ˆç¹çäº†ï¼Œå› æ­¤å¯ä»¥é€šè¿‡æ‰“åŒ…å‘½ä»¤æ¥å®Œæˆã€‚</p>
<pre><code class="lang-bash">xmake f -p iphoneos -a armv7
xmake
xmake package
xmake f -p iphoneos -a arm64 -m debug
xmake
xmake package
</code></pre>
<p>ä¸Šè¿°å‘½ä»¤ï¼Œç¼–è¯‘äº†iphoneosä¸‹ï¼Œä¸¤ä¸ªarchåº“ï¼Œå¹¶ä¸”å…¶ä¸­arm64åº“æ˜¯debugç‰ˆæœ¬çš„ï¼Œè¿›è¡Œæ‰“åŒ…ï¼Œç”Ÿæˆåçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>build/tbox.pkg/
â”œâ”€â”€ iphoneos
â”‚   â”œâ”€â”€ arm64
â”‚   â”‚   â”œâ”€â”€ include
â”‚   â”‚   â”‚   â””â”€â”€ tbox
â”‚   â”‚   â”‚       â”œâ”€â”€ algorithm
â”‚   â”‚   â””â”€â”€ lib
â”‚   â”‚       â””â”€â”€ debug
â”‚   â”‚           â””â”€â”€ libtbox.a
â”‚   â””â”€â”€ armv7
â”‚       â”œâ”€â”€ include
â”‚       â”‚   â””â”€â”€ tbox
â”‚       â””â”€â”€ lib
â”‚           â””â”€â”€ release
â”‚               â””â”€â”€ libtbox.a
â””â”€â”€ xmake.lua
</code></pre><p>å¯ä»¥çœ‹å‡ºï¼Œæ‰“åŒ…å‘½ä»¤ï¼Œä¼šåœ¨buildç›®å½•ä¸‹ç”Ÿæˆtbox.pkgåŒ…ï¼Œé‡Œé¢å¯¹ä¸åŒå¹³å°ã€ä¸åŒarchã€ä¸åŒç¼–è¯‘æ¨¡å¼ä»¥åŠå¤´æ–‡ä»¶éƒ½åšäº†å½’ç±»æ•´ç†ï¼Œè¿™å¯¹äºä¸€æ¬¡è¾“å‡ºä¸åŒçš„åº“æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚</p>
<p>å¹¶ä¸”ï¼Œxmakeè¿˜æä¾›äº†ä¸€ä¸ªè¾…åŠ©çš„å®å‘½ä»¤ï¼Œå¯ä»¥é”¦è¡£ç®€åŒ–æ‰“åŒ…æµç¨‹ï¼Œå®ç°å¯¹ä¸€ä¸ªå¹³å°ä¸‹çš„æ‰€æœ‰archï¼Œè¿›è¡Œæ‰¹é‡æ‰“åŒ…ï¼Œå°¤å…¶æ˜¯iphoneosä¸‹ï¼Œè¿˜ä¼šåŒæ—¶ç”ŸæˆuniversalåŒ…ï¼š</p>
<pre><code class="lang-bash">xmake macro package -p iphoneos
</code></pre>
<p>å¦‚æœæƒ³è¦åˆ‡åˆ°debugæ¨¡å¼ï¼Œä¸€æ¬¡ç”Ÿæˆæ‰€æœ‰archçš„åŒ…ï¼Œå¯ä»¥ä¼ é€’é…ç½®è¿›å»ï¼š</p>
<pre><code class="lang-bash">xmake macro package -p iphoneos -f &quot;-m debug&quot;
</code></pre>
<h3 id="-">é›†æˆåº“</h3>
<h4 id="-">é›†æˆæœ¬åœ°åŒ…</h4>
<p>æˆ‘ä»¬é€šè¿‡xmakeçš„æ‰“åŒ…å‘½ä»¤ç”Ÿæˆçš„tbox.pkgåŒ…ï¼Œæ˜¯å¯ä»¥ç›´æ¥å¼•ç”¨é›†æˆåˆ°è‡ªå·±é¡¹ç›®ä¸­å»çš„ï¼Œåªè¦è®¾ç½®ä¸Šå¯¹åº”çš„å¤´æ–‡ä»¶æœç´¢è·¯å¾„ä»¥åŠåº“è·¯å¾„å³å¯</p>
<p>è€Œå¦‚æœæ˜¯åœ¨xmakeçš„é¡¹ç›®ä¸­ï¼Œé›†æˆå°±æ›´åŠ æ–¹ä¾¿äº†ï¼Œåªéœ€è¦ç¼–è¾‘xmake.luaæ–‡ä»¶ï¼ŒåŠ ä¸Šä¸¤è¡Œï¼š</p>
<pre><code class="lang-lua">add_packagedirs(&quot;packages&quot;)
target(&quot;test&quot;)
    set_kind(&quot;binary&quot;)
    add_files(&quot;src/*.c&quot;)
    add_packages(&quot;tbox&quot;)
</code></pre>
<p>æˆ‘ä»¬é€šè¿‡add_packagedirsæŒ‡å®šä¸‹tbox.pkgæ‰€åœ¨çš„ç›®å½•ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡<code>add_packages(&quot;tbox&quot;)</code>ç›´æ¥å¼•ç”¨é›†æˆå¯¹åº”çš„åŒ…ï¼Œxmakeåœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å¤„ç†å¤´æ–‡ä»¶å’Œåº“è·¯å¾„çš„æœç´¢ã€‚</p>
<p>!&gt; ä¸è¿‡éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœæ˜¯ç¼–è¯‘ä½¿ç”¨debugç‰ˆæœ¬çš„tboxåº“ï¼Œè¿˜éœ€è¦åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œé¢å¤–å®šä¹‰<code>__tb_debug__</code>å®æ ‡ç¤ºä¸‹æ‰è¡Œã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å®Œå–„ä¸‹ï¼ŒåŠ ä¸Šrelease/debugæ¨¡å¼æ”¯æŒï¼š</p>
<pre><code class="lang-lua">add_packagedirs(&quot;packages&quot;)
add_rules(&quot;mode.debug&quot;, &quot;mode.release&quot;)
if is_mode(&quot;debug&quot;) then
    add_defines(&quot;__tb_debug__&quot;)
end
target(&quot;test&quot;)
    set_kind(&quot;binary&quot;)
    add_files(&quot;src/*.c&quot;)
    add_packages(&quot;tbox&quot;)
</code></pre>
<h4 id="-">é›†æˆè¿œç¨‹ä¾èµ–åŒ…</h4>
<p>å½“ç„¶å¦‚æœè§‰å¾—è¿™æ ·ç¼–è¯‘tboxåº“é›†æˆè¿˜æ˜¯æ¯”è¾ƒç¹çï¼Œå¯ä»¥é‡‡ç”¨ä¸Šé¢è¯´çš„è¿œç¨‹ä¾èµ–ä¸‹è½½æ¨¡å¼ï¼Œxmakeä¼šè‡ªå·±å¤„ç†tboxåº“çš„ä¸‹è½½ç¼–è¯‘å’Œé›†æˆã€‚</p>
<pre><code class="lang-lua">add_requires(&quot;tbox&quot;)
add_rules(&quot;mode.debug&quot;, &quot;mode.release&quot;)
target(&quot;test&quot;)
    set_kind(&quot;binary&quot;)
    add_files(&quot;src/*.c&quot;)
    add_packages(&quot;tbox&quot;)
</code></pre>
<p>æˆ‘ä»¬ä¸éœ€è¦å†è‡ªå·±ä¸‹è½½æºç ç¼–è¯‘tboxï¼Œåªéœ€è¦è®¾ç½®<code>add_requires(&quot;tbox&quot;)</code>æ·»åŠ éœ€è¦çš„åŒ…ä¾èµ–å°±è¡Œäº†ï¼Œxmakeä¼šè‡ªåŠ¨ä»å®˜æ–¹åŒ…ä»“åº“ä¸‹è½½tboxåŒ…çš„æè¿°ä¿¡æ¯ï¼Œç„¶åè‡ªåŠ¨ç¼–è¯‘å’Œå®‰è£…é›†æˆï¼Œæœ‰ç‚¹ç±»ä¼¼homebrewçš„æ–¹å¼ã€‚</p>
<p>å¦‚æœéœ€è¦ä½¿ç”¨debugç‰ˆæœ¬tboxåº“ï¼Œåªéœ€è¦æ”¹æˆï¼š</p>
<pre><code class="lang-lua">add_requires(&quot;tbox&quot;, {debug = true})
</code></pre>
<p>ç”¨æˆ·ä¹Ÿä¸éœ€è¦é¢å¤–åŠ <code>__tb_debug__</code>å®äº†å› ä¸ºè¿™äº›éƒ½ä¼šè‡ªåŠ¨å¤„ç†ã€‚</p>
<p>å¦‚æœè¦ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„tboxåº“ï¼Œæˆ–è€…dev/masterç‰ˆæœ¬åº“ï¼Œåªéœ€è¦ï¼š</p>
<pre><code class="lang-lua">add_requires(&quot;tbox dev&quot;)
add_requires(&quot;tbox master&quot;)
add_requires(&quot;tbox 1.6.3&quot;)
add_requires(&quot;tbox &gt;1.6.0&quot;)
add_requires(&quot;tbox ~1.6.0&quot;)
</code></pre>
<p>é›†æˆæ–¹å¼æ˜¯æ”¯æŒè¯­ä¹‰ç‰ˆæœ¬ä¾èµ–çš„å“¦ï¼Œæ›´å¤šå…³äºè¿™å—çš„ä½¿ç”¨æè¿°ï¼Œå¯ä»¥çœ‹ä¸‹xmakeçš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://xmake.io/#/zh-cn/guide/package_management?id=%e8%bf%9c%e7%a8%8b%e4%be%9d%e8%b5%96%e6%a8%a1%e5%bc%8f">è¿œç¨‹ä¾èµ–æ¨¡å¼</a></p>
<h3 id="-">æ¨¡å—é…ç½®</h3>
<p>é»˜è®¤ç¼–è¯‘å’Œé›†æˆçš„tboxåº“ï¼Œä¸ºsmallç¼–è¯‘æ¨¡å¼ï¼Œæ˜¯ä¸å¸¦æœ‰ä»»ä½•æ‰©å±•æ¨¡å—çš„ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨ä¸€äº›æ‰©å±•ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨å¯ç”¨ã€‚</p>
<p>å¯¹äºæºç ç¼–è¯‘æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å¯ç”¨å¯¹åº”æ¨¡å—æ¥ç¼–è¯‘tbox:</p>
<pre><code class="lang-bash">xmake f --xml=y --coroutine=y
xmake
</code></pre>
<p>å¯¹äºè¿œç¨‹ä¾èµ–æ–¹å¼ï¼Œå¯ç”¨å¯¹åº”æ¨¡å—ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œåœ¨xmake.luaé‡Œé¢æ”¹ä¸‹ä¾èµ–è§„åˆ™å°±å¥½ï¼š</p>
<pre><code class="lang-lua">add_requires(&quot;tbox&quot;, {configs = {xml = true, coroutine = true}})
</code></pre>
<h3 id="-">ä»£ç ç¤ºä¾‹</h3>
<p>tboxçš„<code>src/demo</code>æºç ç›®å½•ä¸‹ï¼Œé›†æˆäº†å„ä¸ªæ¨¡å—çš„ä½¿ç”¨ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒå…¶ä¸­çš„ç”¨æ³•ä¹Ÿç†Ÿæ‚‰ä¸åŒæ¨¡å—æ¥å£çš„ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å‚çœ‹å¯¹åº”æ¨¡å—å¤´æ–‡ä»¶ä¸­çš„æ¥å£æ³¨é‡Šè¯´æ˜æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<p>è€Œdemoä¸‹çš„æµ‹è¯•è¿è¡Œï¼Œå¯ä»¥è¿›å…¥tboxæ ¹ç›®å½•ï¼Œç¼–è¯‘åé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥è¿è¡Œï¼š</p>
<pre><code class="lang-bash">xmake run demo coroutine_http_server
</code></pre>
<p>ä¸Šé¢çš„å‘½ä»¤å°±æ˜¯è¿è¡Œtboxä¸­çš„åŸºäºåç¨‹çš„<code>http_server</code>ä¾‹å­ç¨‹åºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤åˆ—ä¸¾å½“å‰æ‰€æœ‰çš„ä¾‹å­ç¨‹åºåï¼š</p>
<pre><code class="lang-bash">xmake run demo
</code></pre>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>[demo]: ======================================================================
[demo]: Usages: xmake r demo [testname] arguments ...
[demo]: 
[demo]: .e.g
[demo]:     xmake r demo stream http://www.xxxxx.com /tmp/a
[demo]: 
[demo]: testname: libc_time
[demo]: testname: libc_wchar
[demo]: testname: libc_string
[demo]: testname: libc_stdlib
[demo]: testname: libc_wcstombs
[demo]: testname: coroutine_echo_client
[demo]: testname: coroutine_file_client
[demo]: testname: coroutine_http_server
[demo]: testname: coroutine_spider
...
</code></pre><p>å¤ªé•¿äº†ï¼Œè¿™é‡Œå°±ä¸å…¨åˆ—ä¸¾å‡ºæ¥ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¿è¡Œåçœ‹ä¸‹ã€‚</p>
<h3 id="-">è°ƒè¯•åˆ†æ</h3>
<p>é™¤äº†ç”¨è°ƒè¯•å™¨è¿è¡Œåè¿›è¡Œè°ƒè¯•ï¼Œtboxåº“çš„debugç‰ˆæœ¬è¿˜å†…ç½®çš„å¤§é‡äº†assertæ£€æµ‹ï¼Œä»¥åŠå„ç§å†…å­˜åˆ†ææ£€æµ‹æ‰‹æ®µï¼ŒåŒ…æ‹¬å†…å­˜æ³„éœ²ï¼Œå†…å­˜è¶Šç•Œåˆ†æç­‰ï¼Œä¾æ‰˜äºtboxåº“è‡ªå¸¦çš„å†…å­˜æ± åˆ†é…å™¨ã€‚</p>
<p>å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä½¿ç”¨tboxåº“å†™å®Œç¨‹åºï¼Œåªè¦åœ¨debugä¸‹è¿è¡Œæ²¡æœ‰ä»»ä½•æŠ¥é”™ï¼ŒåŸºæœ¬ä¸Šç¨‹åºç®—æ˜¯æ¯”è¾ƒç¨³å®šäº†ã€‚</p>
<h4 id="-">æ–­è¨€æ£€æµ‹</h4>
<p>tboxé‡Œé¢æ‰€æœ‰æ¥å£å®ç°ï¼ŒåŠ äº†å¤§é‡çš„assertæ¥åˆ¤æ–­ç¨‹åºçŠ¶æ€å’Œä¼ å‚çš„æœ‰æ•ˆæ€§ï¼Œåªè¦ç”¨æˆ·ä¼ å‚ä¸å¯¹ï¼Œåœ¨debugæ¨¡å¼åŸºæœ¬ä¸Šéƒ½èƒ½ç¬¬ä¸€æ—¶é—´æŠ¥å‡ºæ¥ï¼Œç”šè‡³ä¸€äº›å †æº¢å‡ºå¯¼è‡´çš„é—®é¢˜ï¼Œä¹Ÿä¼šå³ä½¿æŠ¥å‡ºã€‚</p>
<p>æ–¹ä¾¿ç”¨æˆ·ç¬¬ä¸€æ—¶é—´è·å–åˆ°é”™è¯¯ä¿¡æ¯ï¼Œå®šä½æ•…éšœä»£ç æ‰€æœ‰ä½ç½®ã€‚</p>
<h4 id="-">å†…å­˜è¶Šç•Œæ£€æµ‹</h4>
<p>ç”¨æˆ·åªè¦å†™å®Œç¨‹åºï¼Œå¯ç”¨debugç‰ˆæœ¬è¿è¡Œç¨‹åºï¼Œç¨‹åºåœ¨å‡ºç°å¸¸è§„å¯¹å†…å­˜è¶Šç•Œåï¼Œä¼šè‡ªåŠ¨æŠ¥é”™æç¤ºã€‚</p>
<p>è¶Šç•Œæº¢å‡ºçš„æ£€æµ‹ï¼Œæ˜¯å®æ—¶å®Œæˆçš„ï¼Œè€Œä¸”å¯¹libcä¹Ÿåšäº†æ’æ¡©ï¼Œæ‰€ä»¥å¯¹å¸¸ç”¨strcpyï¼Œmemsetç­‰çš„ä½¿ç”¨ï¼Œéƒ½å›å»æ£€æµ‹ï¼š</p>
<pre><code class="lang-c">tb_void_t tb_demo_overflow()
{
    tb_pointer_t data = tb_malloc0(10);
    if (data)
    {
        tb_memset(data, 0, 11);
        tb_free(data);
    }
}
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code>[tbox]: [memset]: [overflow]: [0x0 x 11] =&gt; [0x7f950b044508, 10]
[tbox]: [memset]: [overflow]: [0x0000010991a1c7]: 0   demo.b                              0x000000010991a1c7 tb_memset + 151
[tbox]: [memset]: [overflow]: [0x000001098a2d01]: 1   demo.b                              0x00000001098a2d01 tb_demo_overflow + 97
[tbox]: [memset]: [overflow]: [0x000001098a3044]: 2   demo.b                              0x00000001098a3044 tb_demo_memory_check_main + 20
[tbox]: [memset]: [overflow]: [0x0000010989a28e]: 3   demo.b                              0x000000010989a28e main + 878
[tbox]: [memset]: [overflow]: [0x007fff8c95a5fd]: 4   libdyld.dylib                       0x00007fff8c95a5fd start + 1
[tbox]: [memset]: [overflow]: [0x00000000000002]: 5   ???                                 0x0000000000000002 0x0 + 2
[tbox]:     [malloc]: [from]: data: from: tb_demo_overflow(): 12, memory/check.c
[tbox]:     [malloc]: [from]:     [0x0000010992662a]: 0   demo.b                              0x000000010992662a tb_fixed_pool_malloc0_ + 186
[tbox]:     [malloc]: [from]:     [0x0000010993892b]: 1   demo.b                              0x000000010993892b tb_small_pool_malloc0_ + 507
[tbox]:     [malloc]: [from]:     [0x00000109934b3c]: 2   demo.b                              0x0000000109934b3c tb_pool_malloc0_ + 540
[tbox]:     [malloc]: [from]:     [0x000001098a2cd7]: 3   demo.b                              0x00000001098a2cd7 tb_demo_overflow + 55
[tbox]:     [malloc]: [from]:     [0x000001098a3044]: 4   demo.b                              0x00000001098a3044 tb_demo_memory_check_main + 20
[tbox]:     [malloc]: [from]:     [0x0000010989a28e]: 5   demo.b                              0x000000010989a28e main + 878
[tbox]:     [malloc]: [from]:     [0x007fff8c95a5fd]: 6   libdyld.dylib                       0x00007fff8c95a5fd start + 1
[tbox]:     [malloc]: [from]:     [0x00000000000002]: 7   ???                                 0x0000000000000002 0x0 + 2
[tbox]:     [malloc]: [from]: data: 0x7f950b044508, size: 10, patch: cc
[tbox]:     [malloc]: [from]: data: first 10-bytes:
[tbox]: ===================================================================================================================================================
[tbox]: 00000000   00 00 00 00  00 00 00 00  00 00                                                                         ..........
[tbox]: [error]: abort at tb_memset(): 255, libc/string/memset.c
</code></pre><h4 id="-">å†…å­˜æ³„éœ²æ£€æµ‹</h4>
<p>å†…å­˜æ³„éœ²çš„æ£€æµ‹å¿…é¡»åœ¨ç¨‹åºé€€å‡ºçš„å‰ä¸€åˆ»ï¼Œè°ƒç”¨<code>tb_exit()</code>çš„æ—¶å€™ï¼Œæ‰ä¼šæ‰§è¡Œï¼Œå¦‚æœæœ‰æ³„éœ²ï¼Œä¼šæœ‰è¯¦ç»†è¾“å‡ºåˆ°ç»ˆç«¯ä¸Šã€‚</p>
<pre><code class="lang-c">tb_void_t tb_demo_leak()
{
    tb_pointer_t data = tb_malloc0(10);
}
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code>[tbox]: [error]: leak: 0x7f9d5b058908 at tb_static_fixed_pool_dump(): 735, memory/impl/static_fixed_pool.c
[tbox]: [error]: data: from: tb_demo_leak(): 43, memory/check.c
[tbox]: [error]:     [0x000001050e742a]: 0   demo.b                              0x00000001050e742a tb_fixed_pool_malloc0_ + 186
[tbox]: [error]:     [0x000001050f972b]: 1   demo.b                              0x00000001050f972b tb_small_pool_malloc0_ + 507
[tbox]: [error]:     [0x000001050f593c]: 2   demo.b                              0x00000001050f593c tb_pool_malloc0_ + 540
[tbox]: [error]:     [0x00000105063cd7]: 3   demo.b                              0x0000000105063cd7 tb_demo_leak + 55
[tbox]: [error]:     [0x00000105063e44]: 4   demo.b                              0x0000000105063e44 tb_demo_memory_check_main + 20
[tbox]: [error]:     [0x0000010505b08e]: 5   demo.b                              0x000000010505b08e main + 878
[tbox]: [error]:     [0x007fff8c95a5fd]: 6   libdyld.dylib                       0x00007fff8c95a5fd start + 1
[tbox]: [error]:     [0x00000000000002]: 7   ???                                 0x0000000000000002 0x0 + 2
[tbox]: [error]: data: 0x7f9d5b058908, size: 10, patch: cc
</code></pre><h4 id="-">å†…å­˜é‡å è¦†ç›–æ£€æµ‹</h4>
<p>å¦‚æœä¸¤å—å†…å­˜çš„copyå‘ç”Ÿäº†é‡å ï¼Œæœ‰å¯èƒ½ä¼šè¦†ç›–æ‰éƒ¨åˆ†æ•°æ®ï¼Œå¯¼è‡´bugï¼Œå› æ­¤TBOXå¯¹æ­¤ä¹Ÿåšäº†äº›æ£€æµ‹ã€‚</p>
<pre><code class="lang-c">tb_void_t tb_demo_overlap()
{
    tb_pointer_t data = tb_malloc(10);
    if (data)
    {
        tb_memcpy(data, (tb_byte_t const*)data + 1, 5);
        tb_free(data);
    }
}
</code></pre>
<p>è¾“å‡º</p>
<pre><code>[tbox]: [memcpy]: [overlap]: [0x7fe9b5042509, 5] =&gt; [0x7fe9b5042508, 5]
[tbox]: [memcpy]: [overlap]: [0x000001094403b8]: 0   demo.b                              0x00000001094403b8 tb_memcpy + 632
[tbox]: [memcpy]: [overlap]: [0x000001093c99f9]: 1   demo.b                              0x00000001093c99f9 tb_demo_overlap + 105
[tbox]: [memcpy]: [overlap]: [0x000001093c9a44]: 2   demo.b                              0x00000001093c9a44 tb_demo_memory_check_main + 20
[tbox]: [memcpy]: [overlap]: [0x000001093c0c8e]: 3   demo.b                              0x00000001093c0c8e main + 878
[tbox]: [memcpy]: [overlap]: [0x007fff8c95a5fd]: 4   libdyld.dylib                       0x00007fff8c95a5fd start + 1
[tbox]: [memcpy]: [overlap]: [0x00000000000002]: 5   ???                                 0x0000000000000002 0x0 + 2
[tbox]:     [malloc]: [from]: data: from: tb_demo_overlap(): 58, memory/check.c
[tbox]:     [malloc]: [from]:     [0x0000010945eadb]: 0   demo.b                              0x000000010945eadb tb_small_pool_malloc_ + 507
[tbox]:     [malloc]: [from]:     [0x0000010945b23c]: 1   demo.b                              0x000000010945b23c tb_pool_malloc_ + 540
[tbox]:     [malloc]: [from]:     [0x000001093c99c7]: 2   demo.b                              0x00000001093c99c7 tb_demo_overlap + 55
[tbox]:     [malloc]: [from]:     [0x000001093c9a44]: 3   demo.b                              0x00000001093c9a44 tb_demo_memory_check_main + 20
[tbox]:     [malloc]: [from]:     [0x000001093c0c8e]: 4   demo.b                              0x00000001093c0c8e main + 878
[tbox]:     [malloc]: [from]:     [0x007fff8c95a5fd]: 5   libdyld.dylib                       0x00007fff8c95a5fd start + 1
[tbox]:     [malloc]: [from]:     [0x00000000000002]: 6   ???                                 0x0000000000000002 0x0 + 2
[tbox]:     [malloc]: [from]: data: 0x7fe9b5042508, size: 10, patch: cc
[tbox]:     [malloc]: [from]: data: first 10-bytes:
[tbox]: ===================================================================================================================================================
[tbox]: 00000000   CC CC CC CC  CC CC CC CC  CC CC                                                                         ..........
[tbox]: [error]: abort at tb_memcpy(): 125, libc/string/memcpy.c
</code></pre><h4 id="-">å†…å­˜åŒé‡é‡Šæ”¾æ£€æµ‹</h4>
<pre><code class="lang-c">tb_void_t tb_demo_free2()
{
    tb_pointer_t data = tb_malloc0(10);
    if (data)
    {
        tb_free(data);
        tb_free(data);
    }
}
</code></pre>
<p>è¾“å‡º</p>
<pre><code>[tbox]: [assert]: expr[((impl-&gt;used_info)[(index) &gt;&gt; 3] &amp; (0x1 &lt;&lt; ((index) &amp; 7)))]: double free data: 0x7fd93386c708 at tb_static_fixed_pool_free(): 612, memory/impl/static_fixed_pool.c
[tbox]:     [0x0000010c9f553c]: 0   demo.b                              0x000000010c9f553c tb_static_fixed_pool_free + 972
[tbox]:     [0x0000010c9ee7a9]: 1   demo.b                              0x000000010c9ee7a9 tb_fixed_pool_free_ + 713
[tbox]:     [0x0000010ca01ff5]: 2   demo.b                              0x000000010ca01ff5 tb_small_pool_free_ + 885
[tbox]:     [0x0000010c9fdb4f]: 3   demo.b                              0x000000010c9fdb4f tb_pool_free_ + 751
[tbox]:     [0x0000010c96ac8e]: 4   demo.b                              0x000000010c96ac8e tb_demo_free2 + 158
[tbox]:     [0x0000010c96ae44]: 5   demo.b                              0x000000010c96ae44 tb_demo_memory_check_main + 20
[tbox]:     [0x0000010c96208e]: 6   demo.b                              0x000000010c96208e main + 878
[tbox]:     [0x007fff8c95a5fd]: 7   libdyld.dylib                       0x00007fff8c95a5fd start + 1
[tbox]:     [0x00000000000002]: 8   ???                                 0x0000000000000002 0x0 + 2
[tbox]: [error]: free(0x7fd93386c708) failed! at tb_demo_free2(): 37, memory/check.c at tb_static_fixed_pool_free(): 649, memory/impl/static_fixed_pool.c
[tbox]: [error]: data: from: tb_demo_free2(): 33, memory/check.c
[tbox]: [error]:     [0x0000010c9ee42a]: 0   demo.b                              0x000000010c9ee42a tb_fixed_pool_malloc0_ + 186
[tbox]: [error]:     [0x0000010ca0072b]: 1   demo.b                              0x000000010ca0072b tb_small_pool_malloc0_ + 507
[tbox]: [error]:     [0x0000010c9fc93c]: 2   demo.b                              0x000000010c9fc93c tb_pool_malloc0_ + 540
[tbox]: [error]:     [0x0000010c96ac27]: 3   demo.b                              0x000000010c96ac27 tb_demo_free2 + 55
[tbox]: [error]:     [0x0000010c96ae44]: 4   demo.b                              0x000000010c96ae44 tb_demo_memory_check_main + 20
[tbox]: [error]:     [0x0000010c96208e]: 5   demo.b                              0x000000010c96208e main + 878
[tbox]: [error]:     [0x007fff8c95a5fd]: 6   libdyld.dylib                       0x00007fff8c95a5fd start + 1
[tbox]: [error]:     [0x00000000000002]: 7   ???                                 0x0000000000000002 0x0 + 2
[tbox]: [error]: data: 0x7fd93386c708, size: 10, patch: cc
[tbox]: [error]: data: first 10-bytes:
[tbox]: ===================================================================================================================================================
[tbox]: 00000000   00 00 00 00  00 00 00 00  00 00                                                                         ..........
[tbox]: [error]: abort at tb_static_fixed_pool_free(): 655, memory/impl/static_fixed_pool.c
</code></pre></article>
</body>
</html>